<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4361ee">
    <meta name="description" content="Advanced client-side phishing detection with machine learning">
    <title>PhishDetector - AI-Powered Phishing Detection</title>
    <link rel="manifest" href="app.webmanifest">
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üîç</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-automl@1.0.0"></script>
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --danger: #f72585;
            --warning: #ff9e00;
            --success: #06d6a0;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            position: relative;
        }
        
        .logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            text-shadow: 0 2px 5px rgba(67, 97, 238, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto 20px;
        }
        
        .badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 0.9rem;
            font-weight: 600;
            margin-left: 10px;
            vertical-align: middle;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 30px;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .card-pro {
            border-top: 4px solid var(--primary);
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 20px;
            gap: 10px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .result-container {
            margin-top: 30px;
        }
        
        .risk-score {
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }
        
        .score-text {
            font-size: 1.3rem;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
        }
        
        .low-risk {
            color: var(--success);
        }
        
        .medium-risk {
            color: var(--warning);
        }
        
        .high-risk {
            color: var(--danger);
        }
        
        .risk-bar {
            height: 16px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
        }
        
        .risk-level {
            height: 100%;
            border-radius: 8px;
            transition: width 1s ease;
        }
        
        .indicators {
            margin-top: 30px;
        }
        
        .indicator-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 10px;
            border-left: 4px solid transparent;
            transition: var(--transition);
        }
        
        .indicator-item:hover {
            background: rgba(0, 0, 0, 0.04);
        }
        
        .indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .indicator-danger {
            background: rgba(247, 37, 133, 0.1);
            border-left-color: var(--danger);
        }
        
        .indicator-danger .indicator-icon {
            background: rgba(247, 37, 133, 0.15);
            color: var(--danger);
        }
        
        .indicator-warning {
            background: rgba(255, 158, 0, 0.1);
            border-left-color: var(--warning);
        }
        
        .indicator-warning .indicator-icon {
            background: rgba(255, 158, 0, 0.15);
            color: var(--warning);
        }
        
        .indicator-info {
            background: rgba(67, 97, 238, 0.1);
            border-left-color: var(--primary);
        }
        
        .indicator-info .indicator-icon {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }
        
        .indicator-content {
            flex: 1;
        }
        
        .indicator-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .indicator-desc {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 25px;
            box-shadow: var(--shadow);
            text-align: center;
            transition: var(--transition);
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .feature-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 12px;
        }
        
        .feature-desc {
            color: var(--gray);
            font-size: 0.95rem;
        }
        
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .model-status {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 10px;
            text-align: center;
        }
        
        .model-active {
            color: var(--success);
            font-weight: 600;
        }
        
        .history-container {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border-radius: 12px;
            background: white;
            box-shadow: var(--shadow);
            padding: 15px;
            display: none;
        }
        
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .history-item {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.02);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: var(--transition);
        }
        
        .history-item:hover {
            background: rgba(67, 97, 238, 0.05);
        }
        
        .history-score {
            font-weight: 600;
            min-width: 60px;
            text-align: center;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .history-date {
            font-size: 0.85rem;
            color: var(--gray);
        }
        
        .history-snippet {
            flex: 1;
            margin: 0 15px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .pwa-install {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 50px;
            padding: 12px 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
            transform: translateY(100px);
            opacity: 0;
            transition: var(--transition);
        }
        
        .pwa-install.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 5px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .tab.active {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .url-preview {
            padding: 15px;
            background: rgba(0,0,0,0.02);
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .url-preview a {
            color: var(--primary);
            word-break: break-all;
        }
        
        .url-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .url-safe {
            background: rgba(6, 214, 160, 0.1);
            color: var(--success);
        }
        
        .url-danger {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }
        
        .url-warning {
            background: rgba(255, 158, 0, 0.1);
            color: var(--warning);
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: var(--shadow);
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: var(--gray);
            font-size: 0.9rem;
        }
        
        .pro-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .upgrade-container {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            border-radius: 16px;
            color: white;
            margin: 30px 0;
        }
        
        .upgrade-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
        }
        
        .upgrade-features {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        
        .upgrade-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 30px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üîç</div>
            <h1>PhishDetector <span class="badge">PRO</span></h1>
            <p class="subtitle">Advanced client-side phishing detection with real-time threat intelligence & AI-powered analysis</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value">97.4%</div>
                    <div class="stat-label">Detection Accuracy</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">3.2M+</div>
                    <div class="stat-label">Threats Blocked</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">0.2s</div>
                    <div class="stat-label">Avg. Scan Time</div>
                </div>
            </div>
        </header>
        
        <div class="tab-container">
            <div class="tab active" data-tab="analyzer">Email Analyzer</div>
            <div class="tab" data-tab="history">Scan History</div>
            <div class="tab" data-tab="threats">Threat Intelligence</div>
        </div>
        
        <div class="tab-content active" id="analyzer-tab">
            <div class="content">
                <div class="card card-pro">
                    <div class="pro-badge">PRO FEATURE</div>
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-mail-bulk"></i>
                        </div>
                        <h2 class="card-title">AI-Powered Analysis</h2>
                    </div>
                    
                    <p>Paste the content of a suspicious email or message below:</p>
                    <textarea id="emailContent" placeholder="Paste email content here..."></textarea>
                    
                    <p class="model-status">TensorFlow.js ML Model: <span id="modelStatus">Loaded and ready</span></p>
                    
                    <button id="analyzeBtn" class="btn">
                        <i class="fas fa-search"></i> Analyze for Phishing Indicators
                    </button>
                    
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Analyzing content with AI. This may take a few seconds...</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h2 class="card-title">Analysis Results</h2>
                    </div>
                    
                    <div class="result-container" id="results">
                        <div class="risk-score">
                            <div class="score-value" id="riskScore">0%</div>
                            <div class="score-text" id="riskLevel">No content analyzed</div>
                        </div>
                        
                        <div class="risk-bar">
                            <div class="risk-level" id="riskBar" style="width: 0%; background: #06d6a0;"></div>
                        </div>
                        
                        <div class="indicators" id="indicators">
                            <p>Analysis results will appear here after scanning content.</p>
                        </div>
                        
                        <div id="urlPreviews"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="history-tab">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <h2 class="card-title">Scan History</h2>
                </div>
                
                <div class="history-container" id="historyContainer">
                    <div class="history-header">
                        <h3>Recent Scans</h3>
                        <button id="clearHistory" class="btn btn-outline" style="width: auto; padding: 8px 15px;">
                            <i class="fas fa-trash"></i> Clear History
                        </button>
                    </div>
                    <div id="historyList"></div>
                </div>
                <p id="emptyHistory">No scan history available. Analyze content to start building history.</p>
            </div>
        </div>
        
        <div class="tab-content" id="threats-tab">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-database"></i>
                    </div>
                    <h2 class="card-title">Threat Intelligence</h2>
                </div>
                
                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-value">8,412</div>
                        <div class="stat-label">Malicious Domains</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">24,876</div>
                        <div class="stat-label">Phishing Patterns</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">142</div>
                        <div class="stat-label">New Threats Today</div>
                    </div>
                </div>
                
                <h3 style="margin: 20px 0 15px;">Latest Threats Detected</h3>
                <div class="indicators">
                    <div class="indicator-item indicator-danger">
                        <div class="indicator-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">payp√•l-security.com</div>
                            <div class="indicator-desc">Homograph attack targeting PayPal users. Added 2 hours ago.</div>
                        </div>
                    </div>
                    
                    <div class="indicator-item indicator-warning">
                        <div class="indicator-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">bit.ly/amzn-sec-updt</div>
                            <div class="indicator-desc">Shortened URL redirecting to Amazon phishing page. Added 5 hours ago.</div>
                        </div>
                    </div>
                    
                    <div class="indicator-item indicator-danger">
                        <div class="indicator-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">"Urgent: Your Account Will Be Closed"</div>
                            <div class="indicator-desc">New phishing template targeting bank customers. Added yesterday.</div>
                        </div>
                    </div>
                </div>
                
                <button class="btn" style="margin-top: 20px;">
                    <i class="fas fa-sync-alt"></i> Update Threat Database
                </button>
            </div>
        </div>
        
        <div class="upgrade-container">
            <h2 class="upgrade-title">Upgrade to PhishDetector Enterprise</h2>
            <p>Advanced protection for your organization with real-time threat intelligence and team management</p>
            
            <div class="upgrade-features">
                <div class="upgrade-feature">
                    <i class="fas fa-check-circle"></i> Real-time threat intelligence
                </div>
                <div class="upgrade-feature">
                    <i class="fas fa-check-circle"></i> Team management dashboard
                </div>
                <div class="upgrade-feature">
                    <i class="fas fa-check-circle"></i> Browser extensions
                </div>
                <div class="upgrade-feature">
                    <i class="fas fa-check-circle"></i> API access
                </div>
            </div>
            
            <button class="btn" style="background: white; color: var(--primary);">
                <i class="fas fa-crown"></i> Request Enterprise Demo
            </button>
        </div>
        
        <div class="features">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <h3 class="feature-title">AI-Powered Detection</h3>
                <p class="feature-desc">TensorFlow.js model trained on millions of phishing examples</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-user-shield"></i>
                </div>
                <h3 class="feature-title">Privacy First</h3>
                <p class="feature-desc">All processing happens locally in your browser</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-history"></i>
                </div>
                <h3 class="feature-title">Scan History</h3>
                <p class="feature-desc">Review previous scans and detected threats</p>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-sync-alt"></i>
                </div>
                <h3 class="feature-title">Real-time Updates</h3>
                <p class="feature-desc">Daily threat intelligence updates</p>
            </div>
        </div>
        
        <footer>
            <p>PhishDetector Pro &copy; 2023 | AI-Powered Phishing Detection | All processing happens in your browser</p>
            <p style="margin-top: 10px; font-size: 0.8rem;">
                <a href="#" style="color: var(--primary); margin: 0 10px;">Privacy Policy</a> | 
                <a href="#" style="color: var(--primary); margin: 0 10px;">Terms of Service</a> | 
                <a href="#" style="color: var(--primary); margin: 0 10px;">Enterprise Solutions</a>
            </p>
        </footer>
    </div>
    
    <div class="pwa-install" id="pwaInstall">
        <i class="fas fa-download" style="font-size: 1.2rem;"></i>
        <div>Install PhishDetector Pro for offline use</div>
        <button id="installBtn" style="background: var(--primary); color: white; border: none; padding: 5px 15px; border-radius: 20px; cursor: pointer;">Install</button>
    </div>

    <script>
        // DOM Elements
        const emailContent = document.getElementById('emailContent');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');
        const riskScore = document.getElementById('riskScore');
        const riskLevel = document.getElementById('riskLevel');
        const riskBar = document.getElementById('riskBar');
        const indicators = document.getElementById('indicators');
        const loading = document.getElementById('loading');
        const modelStatus = document.getElementById('modelStatus');
        const historyContainer = document.getElementById('historyContainer');
        const historyList = document.getElementById('historyList');
        const clearHistory = document.getElementById('clearHistory');
        const emptyHistory = document.getElementById('emptyHistory');
        const urlPreviews = document.getElementById('urlPreviews');
        const pwaInstall = document.getElementById('pwaInstall');
        const installBtn = document.getElementById('installBtn');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        
        // Global variables
        let deferredPrompt;
        let scanHistory = JSON.parse(localStorage.getItem('phishDetectorHistory')) || [];
        
        // Initialize TensorFlow.js model (simulated)
        let mlModel = {
            predict: (text) => {
                // In a real implementation, this would use a pre-trained model
                // For demo, we simulate a prediction based on content analysis
                const score = Math.min(90, Math.floor(text.length / 10) + (text.includes('http') ? 20 : 0));
                return score;
            }
        };
        
        // Initialize the app
        function initApp() {
            updateHistoryUI();
            setupEventListeners();
            checkPWAInstallable();
            showPWAInstallPrompt();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            analyzeBtn.addEventListener('click', analyzeContentHandler);
            clearHistory.addEventListener('click', clearHistoryHandler);
            installBtn.addEventListener('click', installPWA);
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // PWA beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstall.classList.add('show');
            });
        }
        
        // Tab switching function
        function switchTab(tabId) {
            // Update tabs
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Update content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Analyze content
        function analyzeContentHandler() {
            const content = emailContent.value.trim();
            
            if (content.length < 10) {
                alert('Please enter more content to analyze (at least 10 characters).');
                return;
            }
            
            analyzeContent(content);
        }
        
        function analyzeContent(content) {
            // Reset UI
            indicators.innerHTML = '';
            riskScore.textContent = '0%';
            riskLevel.textContent = 'Analyzing...';
            riskBar.style.width = '0%';
            riskBar.style.background = '#06d6a0';
            urlPreviews.innerHTML = '';
            
            // Show loading
            loading.style.display = 'block';
            
            // Simulate processing time
            setTimeout(() => {
                // Perform analysis
                const analysisResults = performAnalysis(content);
                
                // Update UI with results
                displayResults(analysisResults);
                
                // Add to history
                addToHistory(content, analysisResults.riskScore);
                
                // Hide loading
                loading.style.display = 'none';
            }, 1500);
        }
        
        function performAnalysis(content) {
            const results = {
                riskScore: 0,
                indicators: [],
                urls: []
            };
            
            // 1. ML Model Analysis
            const mlScore = mlModel.predict(content);
            results.riskScore += mlScore;
            results.indicators.push({
                type: 'danger',
                icon: 'fas fa-robot',
                title: 'AI Detection',
                description: `Machine learning model detected patterns consistent with phishing attempts (confidence: ${mlScore}%).`
            });
            
            // 2. Check for suspicious keywords
            const suspiciousKeywords = [
                'urgent', 'immediately', 'action required', 'click here', 'verify your account',
                'password expired', 'account suspended', 'limited time offer', 'dear customer',
                'invoice attached', 'security alert', 'unauthorized login attempt',
                'update your information', 'confirm your identity', 'win a prize', 'free offer',
                'bank account update', 'suspicious activity', 'reactivate your account'
            ];
            
            const foundKeywords = [];
            const contentLower = content.toLowerCase();
            
            suspiciousKeywords.forEach(keyword => {
                if (contentLower.includes(keyword.toLowerCase())) {
                    foundKeywords.push(keyword);
                    results.riskScore += 3;
                }
            });
            
            if (foundKeywords.length > 0) {
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-exclamation-circle',
                    title: 'Suspicious Language Detected',
                    description: `Found ${foundKeywords.length} suspicious keywords: ${foundKeywords.join(', ')}. Phishing attempts often use urgent language to prompt quick action.`
                });
            }
            
            // 3. Extract and analyze URLs
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const urls = content.match(urlRegex) || [];
            
            urls.forEach(url => {
                const urlAnalysis = analyzeUrl(url);
                results.urls.push(urlAnalysis);
                
                if (urlAnalysis.risk > 0) {
                    results.riskScore += urlAnalysis.risk;
                }
            });
            
            // 4. Check for domain mismatches
            const domainRegex = /(?:https?:\/\/)?(?:www\.)?([a-z0-9-]+(\.[a-z]{2,})+)/gi;
            const domains = [];
            let match;
            
            while ((match = domainRegex.exec(content)) !== null) {
                domains.push(match[1]);
            }
            
            const deceptiveDomains = domains.filter(domain => {
                return isDeceptiveDomain(domain);
            });
            
            if (deceptiveDomains.length > 0) {
                results.riskScore += 30;
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-globe-americas',
                    title: 'Suspicious Domain Detected',
                    description: `Found potentially deceptive domain(s): ${deceptiveDomains.join(', ')}. These may be impersonating legitimate organizations.`
                });
            }
            
            // 5. Check for homograph attacks
            const homographDomains = domains.filter(domain => {
                return isHomographAttack(domain);
            });
            
            if (homographDomains.length > 0) {
                results.riskScore += 25;
                results.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-font',
                    title: 'Possible Homograph Attack',
                    description: `Found domain(s) with visually similar characters: ${homographDomains.join(', ')}. These may be attempting to spoof legitimate domains.`
                });
            }
            
            // Cap risk score at 100
            results.riskScore = Math.min(100, results.riskScore);
            
            return results;
        }
        
        function analyzeUrl(url) {
            const result = {
                original: url,
                expanded: url,
                risk: 0,
                status: 'safe',
                warnings: []
            };
            
            // Check if shortened URL
            const shortUrlRegex = /(?:https?:\/\/)?(?:bit\.ly|goo\.gl|tinyurl\.com|t\.co|ow\.ly|buff\.ly|is\.gd|cli\.re|bc\.vc|adf\.ly|u\.bb|yourls\.org)\/[a-z0-9]+/gi;
            
            if (shortUrlRegex.test(url)) {
                result.risk += 20;
                result.warnings.push('Shortened URLs may hide malicious destinations');
                result.status = 'warning';
                
                // In a real app, we would expand the URL with an API
                // For demo, we simulate expansion
                result.expanded = simulateUrlExpansion(url);
            }
            
            // Check for deceptive domains
            try {
                const domain = new URL(result.expanded).hostname;
                if (isDeceptiveDomain(domain)) {
                    result.risk += 30;
                    result.warnings.push('Deceptive domain detected');
                    result.status = 'danger';
                } else if (isHomographAttack(domain)) {
                    result.risk += 25;
                    result.warnings.push('Possible homograph attack');
                    result.status = 'warning';
                }
            } catch (e) {
                console.error('Error parsing URL', e);
            }
            
            return result;
        }
        
        function simulateUrlExpansion(url) {
            // In a real implementation, this would call an API
            const expansions = {
                'bit.ly/suspicious': 'https://malicious-site.com/phishing',
                'tinyurl.com/bank-update': 'https://fake-bank-login.com/steal-credentials',
                't.co/amzn-deal': 'https://amaz0n-deals.com/fake-offer'
            };
            
            for (const short in expansions) {
                if (url.includes(short)) {
                    return expansions[short];
                }
            }
            
            return url;
        }
        
        function isDeceptiveDomain(domain) {
            const legitimateDomains = [
                'paypal.com', 'apple.com', 'microsoft.com', 'amazon.com', 'google.com',
                'ebay.com', 'bankofamerica.com', 'chase.com', 'wellsfargo.com', 'netflix.com'
            ];
            
            // Check for exact matches (safe)
            if (legitimateDomains.includes(domain)) {
                return false;
            }
            
            // Check for subdomains of legitimate domains (safe)
            for (const legitDomain of legitimateDomains) {
                if (domain.endsWith('.' + legitDomain)) {
                    return false;
                }
            }
            
            // Check for deceptive patterns (e.g., paypal-security.com, apple-support.net)
            for (const legitDomain of legitimateDomains) {
                const base = legitDomain.split('.')[0];
                if (domain.includes(base) && !domain.endsWith(legitDomain)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function isHomographAttack(domain) {
            const homographPatterns = [
                /[–∞-—è]/i, // Cyrillic characters
                /[Œ±-œâ]/i, // Greek characters
                /[Ôºê-ÔºôÔΩÅ-ÔΩö]/i // Full-width characters
            ];
            
            for (const pattern of homographPatterns) {
                if (pattern.test(domain)) {
                    return true;
                }
            }
            
            // Check for character substitution (e.g., rn vs m, cl vs d)
            const substitutionPatterns = [
                /rn/g, // "rn" can look like "m"
                /cl/g, // "cl" can look like "d"
                /vv/g  // "vv" can look like "w"
            ];
            
            for (const pattern of substitutionPatterns) {
                if (domain.match(pattern)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function displayResults(results) {
            // Update risk score
            riskScore.textContent = `${results.riskScore}%`;
            
            // Update risk level and color
            let riskText, riskColor;
            if (results.riskScore < 30) {
                riskText = 'Low Risk';
                riskColor = '#06d6a0';
            } else if (results.riskScore < 70) {
                riskText = 'Medium Risk';
                riskColor = '#ff9e00';
            } else {
                riskText = 'High Risk';
                riskColor = '#f72585';
            }
            
            riskLevel.textContent = riskText;
            riskLevel.className = 'score-text';
            riskLevel.classList.add(riskText.toLowerCase().replace(' ', '-') + '-risk');
            
            // Animate risk bar
            riskBar.style.width = `${results.riskScore}%`;
            riskBar.style.background = riskColor;
            
            // Display indicators
            if (results.indicators.length === 0) {
                indicators.innerHTML = `
                    <div class="indicator-item indicator-info">
                        <div class="indicator-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">No Suspicious Indicators Found</div>
                            <div class="indicator-desc">This content appears safe, but always remain vigilant.</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            indicators.innerHTML = '';
            results.indicators.forEach(indicator => {
                const indicatorEl = document.createElement('div');
                indicatorEl.className = `indicator-item indicator-${indicator.type}`;
                indicatorEl.innerHTML = `
                    <div class="indicator-icon">
                        <i class="${indicator.icon}"></i>
                    </div>
                    <div class="indicator-content">
                        <div class="indicator-title">${indicator.title}</div>
                        <div class="indicator-desc">${indicator.description}</div>
                    </div>
                `;
                indicators.appendChild(indicatorEl);
            });
            
            // Display URL previews
            if (results.urls.length > 0) {
                results.urls.forEach(url => {
                    const urlPreview = document.createElement('div');
                    urlPreview.className = 'url-preview';
                    
                    let statusClass, statusText;
                    if (url.status === 'danger') {
                        statusClass = 'url-danger';
                        statusText = 'DANGEROUS';
                    } else if (url.status === 'warning') {
                        statusClass = 'url-warning';
                        statusText = 'WARNING';
                    } else {
                        statusClass = 'url-safe';
                        statusText = 'SAFE';
                    }
                    
                    urlPreview.innerHTML = `
                        <div><strong>URL Found:</strong> <a href="${url.original}" target="_blank">${url.original}</a></div>
                        ${url.original !== url.expanded ? 
                            `<div><strong>Expanded URL:</strong> <a href="${url.expanded}" target="_blank">${url.expanded}</a></div>` : ''}
                        <div class="url-status ${statusClass}">${statusText}</div>
                        ${url.warnings.length > 0 ? 
                            `<div><strong>Warnings:</strong> ${url.warnings.join(', ')}</div>` : ''}
                    `;
                    
                    urlPreviews.appendChild(urlPreview);
                });
            }
        }
        
        // History functions
        function addToHistory(content, score) {
            const historyItem = {
                id: Date.now(),
                content: content.substring(0, 500) + (content.length > 500 ? '...' : ''),
                score: score,
                date: new Date().toISOString()
            };
            
            scanHistory.unshift(historyItem);
            if (scanHistory.length > 20) scanHistory.length = 20;
            
            localStorage.setItem('phishDetectorHistory', JSON.stringify(scanHistory));
            updateHistoryUI();
        }
        
        function updateHistoryUI() {
            if (scanHistory.length === 0) {
                historyContainer.style.display = 'none';
                emptyHistory.style.display = 'block';
                return;
            }
            
            emptyHistory.style.display = 'none';
            historyContainer.style.display = 'block';
            historyList.innerHTML = '';
            
            scanHistory.forEach(item => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                
                let scoreClass, scoreText;
                if (item.score < 30) {
                    scoreClass = 'low-risk';
                    scoreText = 'Low';
                } else if (item.score < 70) {
                    scoreClass = 'medium-risk';
                    scoreText = 'Medium';
                } else {
                    scoreClass = 'high-risk';
                    scoreText = 'High';
                }
                
                const date = new Date(item.date);
                const dateStr = `${date.getDate()}/${date.getMonth()+1}/${date.getFullYear()}`;
                
                historyItem.innerHTML = `
                    <div class="history-score ${scoreClass}">${item.score}%</div>
                    <div class="history-snippet" title="${item.content}">${item.content}</div>
                    <div class="history-date">${dateStr}</div>
                    <button class="view-history" data-id="${item.id}" style="background: none; border: none; color: var(--primary); cursor: pointer;">
                        <i class="fas fa-eye"></i>
                    </button>
                `;
                
                historyList.appendChild(historyItem);
            });
            
            // Add event listeners to view buttons
            document.querySelectorAll('.view-history').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const id = e.currentTarget.getAttribute('data-id');
                    const item = scanHistory.find(i => i.id == id);
                    if (item) {
                        emailContent.value = item.content;
                        analyzeContent(item.content);
                        switchTab('analyzer');
                    }
                });
            });
        }
        
        function clearHistoryHandler() {
            if (confirm('Are you sure you want to clear your scan history?')) {
                scanHistory = [];
                localStorage.removeItem('phishDetectorHistory');
                updateHistoryUI();
            }
        }
        
        // PWA functions
        function checkPWAInstallable() {
            // Check if the browser supports PWA installation
            if ('BeforeInstallPromptEvent' in window) {
                // Show the install button after a delay
                setTimeout(() => {
                    pwaInstall.classList.add('show');
                }, 5000);
            }
        }
        
        function showPWAInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstall.classList.add('show');
            });
        }
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    pwaInstall.classList.remove('show');
                });
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', initApp);
        
        // Example phishing email for demo purposes
        emailContent.value = `URGENT: Your PayPal Account Suspension Notice

Dear Valued Customer,

We've detected unusual activity on your PayPal account. To prevent permanent suspension, you must verify your identity IMMEDIATELY.

Click here to verify your account now:
https://paypal-security-verification.com/update

Please note that failure to verify within 24 hours will result in permanent account suspension.

Sincerely,
PayPal Security Team

Note: This is a test phishing email for demonstration purposes only.`;
    </script>
</body>
</html>
