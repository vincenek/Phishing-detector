<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4361ee">
    <meta name="description" content="Client-side phishing detection tool">
    <title>PhishDetector - Analyze Suspicious Emails</title>
    
    <!-- PWA Manifest and Icons -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlBoaXNoRGV0ZWN0b3IiLAogICJzaG9ydF9uYW1lIjogIlBoaXNoRGV0ZWN0IiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJ0aGVtZV9jb2xvciI6ICIjNDM2MWVlIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjVmN2ZhIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXpOVEFnTlRBd0lqNDhjM1I1YkdVK8lEeHdZWFJvSUdacGJHdzlJblZ5YkNnalptbHNkR1Z5TVM0d0xqQXVNQ0F4TURBdU1UWWlQZzBLUDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F6TlRBZ05UQXdJajQ4YzNSNWJHVSvJRHh3WVhSb0lHWnBiR3c5SW5WeWJDZ2pabWxzZEdWeU1TNHdMakF1TUNBeE1EQXVNVFlpUGcwS1AzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjNDM2MWVlIj48cGF0aCBkPSJNMjU2IDBDMTE0LjYgMCAwIDExNC42IDAgMjU2czExNC42IDI1NiAyNTYgMjU2IDI1Ni0xMTQuNiAyNTYtMjU2UzM5Ny40IDAgMjU2IDB6bTAgNDQ4Yy0xMDUuOSAwLTE5Mi04Ni4xLTE5Mi0xOTJTMjUwLjEgNjQgMjU2IDY0czE5MiA4Ni4xIDE5MiAxOTItODYuMSAxOTItMTkyIDE5MnpNMTkyIDIyNGMwLTEzLjMgMTAuNy0yNCAyNC0yNGgxNDRjMTMuMyAwIDI0IDEwLjcgMjQgMjRzLTEwLjcgMjQtMjQgMjRIMjE2Yy0xMy4zIDAtMjQtMTAuNy0yNC0yNHptMjQgNzJIMjE2Yy0xMy4zIDAtMjQgMTAuNy0yNCAyNHMxMC43IDI0IDI0IDI0aDgwYzEzLjMgMCAyNC0xMC43IDI0LTI0cy0xMC43LTI0LTI0LTI0eiIvPjwvc3ZnPg==">
    
    <!-- TensorFlow.js for ML analysis -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-automl@1.0.0"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --danger: #f72585;
            --warning: #ff9e00;
            --success: #06d6a0;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        .logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            text-shadow: 0 2px 5px rgba(67, 97, 238, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto 20px;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 30px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 20px;
            gap: 10px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .result-container {
            margin-top: 30px;
        }
        
        .risk-score {
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }
        
        .score-text {
            font-size: 1.3rem;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
        }
        
        .low-risk {
            color: var(--success);
        }
        
        .medium-risk {
            color: var(--warning);
        }
        
        .high-risk {
            color: var(--danger);
        }
        
        .risk-bar {
            height: 16px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
        }
        
        .risk-level {
            height: 100%;
            border-radius: 8px;
            transition: width 1s ease;
        }
        
        .indicators {
            margin-top: 30px;
        }
        
        .indicator-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 10px;
            border-left: 4px solid transparent;
            transition: var(--transition);
        }
        
        .indicator-item:hover {
            background: rgba(0, 0, 0, 0.04);
        }
        
        .indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .indicator-danger {
            background: rgba(247, 37, 133, 0.1);
            border-left-color: var(--danger);
        }
        
        .indicator-danger .indicator-icon {
            background: rgba(247, 37, 133, 0.15);
            color: var(--danger);
        }
        
        .indicator-warning {
            background: rgba(255, 158, 0, 0.1);
            border-left-color: var(--warning);
        }
        
        .indicator-warning .indicator-icon {
            background: rgba(255, 158, 0, 0.15);
            color: var(--warning);
        }
        
        .indicator-info {
            background: rgba(67, 97, 238, 0.1);
            border-left-color: var(--primary);
        }
        
        .indicator-info .indicator-icon {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }
        
        .indicator-content {
            flex: 1;
        }
        
        .indicator-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .indicator-desc {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .model-status {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 10px;
            text-align: center;
        }
        
        .model-active {
            color: var(--success);
            font-weight: 600;
        }
        
        .url-preview {
            padding: 15px;
            background: rgba(0,0,0,0.02);
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .url-preview a {
            color: var(--primary);
            word-break: break-all;
        }
        
        .url-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .url-safe {
            background: rgba(6, 214, 160, 0.1);
            color: var(--success);
        }
        
        .url-danger {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }
        
        .url-warning {
            background: rgba(255, 158, 0, 0.1);
            color: var(--warning);
        }
        
        /* PWA Install Button */
        .pwa-install-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
        
        .pwa-install-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: none;
            animation: pulse 2s infinite;
        }
        
        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 16px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            transform: translateY(150%);
            transition: transform 0.5s ease;
        }
        
        .install-prompt.show {
            transform: translateY(0);
        }
        
        .install-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .install-text {
            flex: 1;
        }
        
        .install-close {
            background: transparent;
            border: none;
            font-size: 20px;
            color: #94a3b8;
            cursor: pointer;
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #f59e0b;
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .offline-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); }
            50% { transform: scale(1.05); }
            100% { transform: scale(0.95); }
        }
        
        @keyframes pulseInstall {
            0% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(67, 97, 238, 0.7);
            }
            
            70% {
                transform: scale(1);
                box-shadow: 0 0 0 10px rgba(67, 97, 238, 0);
            }
            
            100% {
                transform: scale(0.95);
                box-shadow: 0 0 0 0 rgba(67, 97, 238, 0);
            }
        }
        
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üîç</div>
            <h1>PhishDetector</h1>
            <p class="subtitle">Client-side tool to analyze suspicious emails or messages for phishing indicators</p>
        </header>
        
        <div class="content">
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-mail-bulk"></i>
                    </div>
                    <h2 class="card-title">Analyze Content</h2>
                </div>
                
                <p>Paste the content of a suspicious email or message below:</p>
                <textarea id="emailContent" placeholder="Paste email content here..."></textarea>
                
                <p class="model-status">TensorFlow.js ML Model: <span id="modelStatus">Loaded and ready</span></p>
                
                <button id="analyzeBtn" class="btn">
                    <i class="fas fa-search"></i> Analyze for Phishing Indicators
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Analyzing content with AI. This may take a few seconds...</p>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <div class="card-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h2 class="card-title">Analysis Results</h2>
                </div>
                
                <div class="result-container" id="results">
                    <div class="risk-score">
                        <div class="score-value" id="riskScore">0%</div>
                        <div class="score-text" id="riskLevel">No content analyzed</div>
                    </div>
                    
                    <div class="risk-bar">
                        <div class="risk-level" id="riskBar" style="width: 0%; background: #06d6a0;"></div>
                    </div>
                    
                    <div class="indicators" id="indicators">
                        <p>Analysis results will appear here after scanning content.</p>
                    </div>
                    
                    <div id="urlPreviews"></div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>PhishDetector &copy; 2023 | Client-side phishing detection tool | All processing happens in your browser</p>
        </footer>
    </div>

    <!-- PWA Install Button -->
    <div class="pwa-install-container" id="pwaInstallContainer">
        <button class="pwa-install-btn" id="pwaInstallBtn">
            <i class="fas fa-download"></i>
        </button>
    </div>
    
    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-icon">
            <i class="fas fa-download"></i>
        </div>
        <div class="install-text">
            <strong>Install PhishDetector</strong>
            <p>Add to home screen for quick access</p>
        </div>
        <button class="install-close" id="closePrompt">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>You are currently offline</span>
    </div>

    <script>
        // DOM Elements
        const emailContent = document.getElementById('emailContent');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');
        const riskScore = document.getElementById('riskScore');
        const riskLevel = document.getElementById('riskLevel');
        const riskBar = document.getElementById('riskBar');
        const indicators = document.getElementById('indicators');
        const loading = document.getElementById('loading');
        const modelStatus = document.getElementById('modelStatus');
        const urlPreviews = document.getElementById('urlPreviews');
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        const pwaInstallContainer = document.getElementById('pwaInstallContainer');
        const installPrompt = document.getElementById('installPrompt');
        const closePrompt = document.getElementById('closePrompt');
        const offlineIndicator = document.getElementById('offlineIndicator');
        
        // Global variables
        let deferredPrompt;
        let isOnline = navigator.onLine;
        
        // Initialize TensorFlow.js model (simulated)
        let mlModel = {
            predict: (text) => {
                // In a real implementation, this would use a pre-trained model
                // For demo, we simulate a prediction based on content analysis
                const score = Math.min(90, Math.floor(text.length / 10) + (text.includes('http') ? 20 : 0));
                return score;
            }
        };
        
        // Initialize the app
        function initApp() {
            setupEventListeners();
            checkPWAInstallable();
            showPWAInstallPrompt();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            analyzeBtn.addEventListener('click', analyzeContentHandler);
            
            // PWA beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstallContainer.style.display = 'block';
            });
            
            // Install button click
            pwaInstallBtn.addEventListener('click', installPWA);
            
            // Close prompt
            closePrompt.addEventListener('click', () => {
                installPrompt.classList.remove('show');
            });
            
            // Online status detection
            window.addEventListener('online', () => {
                isOnline = true;
                offlineIndicator.classList.remove('show');
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                offlineIndicator.classList.add('show');
            });
        }
        
        // Analyze content
        function analyzeContentHandler() {
            const content = emailContent.value.trim();
            
            if (content.length < 10) {
                alert('Please enter more content to analyze (at least 10 characters).');
                return;
            }
            
            analyzeContent(content);
        }
        
        function analyzeContent(content) {
            // Reset UI
            indicators.innerHTML = '';
            riskScore.textContent = '0%';
            riskLevel.textContent = 'Analyzing...';
            riskBar.style.width = '0%';
            riskBar.style.background = '#06d6a0';
            urlPreviews.innerHTML = '';
            
            // Show loading
            loading.style.display = 'block';
            
            // Simulate processing time
            setTimeout(() => {
                // Perform analysis
                const analysisResults = performAnalysis(content);
                
                // Update UI with results
                displayResults(analysisResults);
                
                // Hide loading
                loading.style.display = 'none';
            }, 1500);
        }
        
        function performAnalysis(content) {
            const results = {
                riskScore: 0,
                indicators: [],
                urls: []
            };
            
            // 1. ML Model Analysis
            const mlScore = mlModel.predict(content);
            results.riskScore += mlScore;
            results.indicators.push({
                type: 'danger',
                icon: 'fas fa-robot',
                title: 'AI Detection',
                description: `Machine learning model detected patterns consistent with phishing attempts (confidence: ${mlScore}%).`
            });
            
            // 2. Check for suspicious keywords
            const suspiciousKeywords = [
                'urgent', 'immediately', 'action required', 'click here', 'verify your account',
                'password expired', 'account suspended', 'limited time offer', 'dear customer',
                'invoice attached', 'security alert', 'unauthorized login attempt',
                'update your information', 'confirm your identity', 'win a prize', 'free offer',
                'bank account update', 'suspicious activity', 'reactivate your account'
            ];
            
            const foundKeywords = [];
            const contentLower = content.toLowerCase();
            
            suspiciousKeywords.forEach(keyword => {
                if (contentLower.includes(keyword.toLowerCase())) {
                    foundKeywords.push(keyword);
                    results.riskScore += 3;
                }
            });
            
            if (foundKeywords.length > 0) {
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-exclamation-circle',
                    title: 'Suspicious Language Detected',
                    description: `Found ${foundKeywords.length} suspicious keywords: ${foundKeywords.join(', ')}. Phishing attempts often use urgent language to prompt quick action.`
                });
            }
            
            // 3. Extract and analyze URLs
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const urls = content.match(urlRegex) || [];
            
            urls.forEach(url => {
                const urlAnalysis = analyzeUrl(url);
                results.urls.push(urlAnalysis);
                
                if (urlAnalysis.risk > 0) {
                    results.riskScore += urlAnalysis.risk;
                }
            });
            
            // 4. Check for domain mismatches
            const domainRegex = /(?:https?:\/\/)?(?:www\.)?([a-z0-9-]+(\.[a-z]{2,})+)/gi;
            const domains = [];
            let match;
            
            while ((match = domainRegex.exec(content)) !== null) {
                domains.push(match[1]);
            }
            
            const deceptiveDomains = domains.filter(domain => {
                return isDeceptiveDomain(domain);
            });
            
            if (deceptiveDomains.length > 0) {
                results.riskScore += 30;
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-globe-americas',
                    title: 'Suspicious Domain Detected',
                    description: `Found potentially deceptive domain(s): ${deceptiveDomains.join(', ')}. These may be impersonating legitimate organizations.`
                });
            }
            
            // 5. Check for homograph attacks
            const homographDomains = domains.filter(domain => {
                return isHomographAttack(domain);
            });
            
            if (homographDomains.length > 0) {
                results.riskScore += 25;
                results.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-font',
                    title: 'Possible Homograph Attack',
                    description: `Found domain(s) with visually similar characters: ${homographDomains.join(', ')}. These may be attempting to spoof legitimate domains.`
                });
            }
            
            // Cap risk score at 100
            results.riskScore = Math.min(100, results.riskScore);
            
            return results;
        }
        
        function analyzeUrl(url) {
            const result = {
                original: url,
                expanded: url,
                risk: 0,
                status: 'safe',
                warnings: []
            };
            
            // Check if shortened URL
            const shortUrlRegex = /(?:https?:\/\/)?(?:bit\.ly|goo\.gl|tinyurl\.com|t\.co|ow\.ly|buff\.ly|is\.gd|cli\.re|bc\.vc|adf\.ly|u\.bb|yourls\.org)\/[a-z0-9]+/gi;
            
            if (shortUrlRegex.test(url)) {
                result.risk += 20;
                result.warnings.push('Shortened URLs may hide malicious destinations');
                result.status = 'warning';
                
                // In a real app, we would expand the URL with an API
                // For demo, we simulate expansion
                result.expanded = simulateUrlExpansion(url);
            }
            
            // Check for deceptive domains
            try {
                const domain = new URL(result.expanded).hostname;
                if (isDeceptiveDomain(domain)) {
                    result.risk += 30;
                    result.warnings.push('Deceptive domain detected');
                    result.status = 'danger';
                } else if (isHomographAttack(domain)) {
                    result.risk += 25;
                    result.warnings.push('Possible homograph attack');
                    result.status = 'warning';
                }
            } catch (e) {
                console.error('Error parsing URL', e);
            }
            
            return result;
        }
        
        function simulateUrlExpansion(url) {
            // In a real implementation, this would call an API
            const expansions = {
                'bit.ly/suspicious': 'https://malicious-site.com/phishing',
                'tinyurl.com/bank-update': 'https://fake-bank-login.com/steal-credentials',
                't.co/amzn-deal': 'https://amaz0n-deals.com/fake-offer'
            };
            
            for (const short in expansions) {
                if (url.includes(short)) {
                    return expansions[short];
                }
            }
            
            return url;
        }
        
        function isDeceptiveDomain(domain) {
            const legitimateDomains = [
                'paypal.com', 'apple.com', 'microsoft.com', 'amazon.com', 'google.com',
                'ebay.com', 'bankofamerica.com', 'chase.com', 'wellsfargo.com', 'netflix.com'
            ];
            
            // Check for exact matches (safe)
            if (legitimateDomains.includes(domain)) {
                return false;
            }
            
            // Check for subdomains of legitimate domains (safe)
            for (const legitDomain of legitimateDomains) {
                if (domain.endsWith('.' + legitDomain)) {
                    return false;
                }
            }
            
            // Check for deceptive patterns (e.g., paypal-security.com, apple-support.net)
            for (const legitDomain of legitimateDomains) {
                const base = legitDomain.split('.')[0];
                if (domain.includes(base) && !domain.endsWith(legitDomain)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function isHomographAttack(domain) {
            const homographPatterns = [
                /[–∞-—è]/i, // Cyrillic characters
                /[Œ±-œâ]/i, // Greek characters
                /[Ôºê-ÔºôÔΩÅ-ÔΩö]/i // Full-width characters
            ];
            
            for (const pattern of homographPatterns) {
                if (pattern.test(domain)) {
                    return true;
                }
            }
            
            // Check for character substitution (e.g., rn vs m, cl vs d)
            const substitutionPatterns = [
                /rn/g, // "rn" can look like "m"
                /cl/g, // "cl" can look like "d"
                /vv/g  // "vv" can look like "w"
            ];
            
            for (const pattern of substitutionPatterns) {
                if (domain.match(pattern)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function displayResults(results) {
            // Update risk score
            riskScore.textContent = `${results.riskScore}%`;
            
            // Update risk level and color
            let riskText, riskColor;
            if (results.riskScore < 30) {
                riskText = 'Low Risk';
                riskColor = '#06d6a0';
            } else if (results.riskScore < 70) {
                riskText = 'Medium Risk';
                riskColor = '#ff9e00';
            } else {
                riskText = 'High Risk';
                riskColor = '#f72585';
            }
            
            riskLevel.textContent = riskText;
            riskLevel.className = 'score-text';
            riskLevel.classList.add(riskText.toLowerCase().replace(' ', '-') + '-risk');
            
            // Animate risk bar
            riskBar.style.width = `${results.riskScore}%`;
            riskBar.style.background = riskColor;
            
            // Display indicators
            if (results.indicators.length === 0) {
                indicators.innerHTML = `
                    <div class="indicator-item indicator-info">
                        <div class="indicator-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">No Suspicious Indicators Found</div>
                            <div class="indicator-desc">This content appears safe, but always remain vigilant.</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            indicators.innerHTML = '';
            results.indicators.forEach(indicator => {
                const indicatorEl = document.createElement('div');
                indicatorEl.className = `indicator-item indicator-${indicator.type}`;
                indicatorEl.innerHTML = `
                    <div class="indicator-icon">
                        <i class="${indicator.icon}"></i>
                    </div>
                    <div class="indicator-content">
                        <div class="indicator-title">${indicator.title}</div>
                        <div class="indicator-desc">${indicator.description}</div>
                    </div>
                `;
                indicators.appendChild(indicatorEl);
            });
            
            // Display URL previews
            if (results.urls.length > 0) {
                results.urls.forEach(url => {
                    const urlPreview = document.createElement('div');
                    urlPreview.className = 'url-preview';
                    
                    let statusClass, statusText;
                    if (url.status === 'danger') {
                        statusClass = 'url-danger';
                        statusText = 'DANGEROUS';
                    } else if (url.status === 'warning') {
                        statusClass = 'url-warning';
                        statusText = 'WARNING';
                    } else {
                        statusClass = 'url-safe';
                        statusText = 'SAFE';
                    }
                    
                    urlPreview.innerHTML = `
                        <div><strong>URL Found:</strong> <a href="${url.original}" target="_blank">${url.original}</a></div>
                        ${url.original !== url.expanded ? 
                            `<div><strong>Expanded URL:</strong> <a href="${url.expanded}" target="_blank">${url.expanded}</a></div>` : ''}
                        <div class="url-status ${statusClass}">${statusText}</div>
                        ${url.warnings.length > 0 ? 
                            `<div><strong>Warnings:</strong> ${url.warnings.join(', ')}</div>` : ''}
                    `;
                    
                    urlPreviews.appendChild(urlPreview);
                });
            }
        }
        
        // PWA functions
        function checkPWAInstallable() {
            // Check if the browser supports PWA installation
            if ('BeforeInstallPromptEvent' in window) {
                // Show the install button after a delay
                setTimeout(() => {
                    pwaInstallContainer.style.display = 'block';
                }, 5000);
            }
        }
        
        function showPWAInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstallContainer.style.display = 'block';
                
                // Also show the install prompt after 5 seconds
                setTimeout(() => {
                    if (deferredPrompt) {
                        installPrompt.classList.add('show');
                    }
                }, 5000);
            });
        }
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    pwaInstallContainer.style.display = 'none';
                    installPrompt.classList.remove('show');
                });
            }
        }
        
        // Register Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    // Create service worker script as a blob
                    const swContent = `
                        const CACHE_NAME = 'phishdetector-v1';
                        const urlsToCache = [
                            './',
                            'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0',
                            'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-automl@1.0.0',
                            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css'
                        ];
                        
                        self.addEventListener('install', event => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then(cache => {
                                        return cache.addAll(urlsToCache);
                                    })
                            );
                        });
                        
                        self.addEventListener('activate', event => {
                            event.waitUntil(
                                caches.keys().then(cacheNames => {
                                    return Promise.all(
                                        cacheNames.map(cacheName => {
                                            if (cacheName !== CACHE_NAME) {
                                                return caches.delete(cacheName);
                                            }
                                        })
                                    );
                                })
                            );
                        });
                        
                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        return response || fetch(event.request);
                                    })
                            );
                        });
                    `;
                    
                    const blob = new Blob([swContent], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    navigator.serviceWorker.register(swUrl)
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.error('Service Worker registration failed:', error);
                        });
                });
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            registerServiceWorker();
            
            // Initialize offline status
            if (!navigator.onLine) {
                offlineIndicator.classList.add('show');
            }
            
            // Example phishing email for demo purposes
            emailContent.value = `URGENT: Your PayPal Account Suspension Notice

Dear Valued Customer,

We've detected unusual activity on your PayPal account. To prevent permanent suspension, you must verify your identity IMMEDIATELY.

Click here to verify your account now:
https://paypal-security-verification.com/update

Please note that failure to verify within 24 hours will result in permanent account suspension.

Sincerely,
PayPal Security Team

Note: This is a test phishing email for demonstration purposes only.`;
        });
    </script>
</body>
</html>
