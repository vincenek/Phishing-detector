<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#4361ee">
    <meta name="description" content="Advanced client-side phishing detection">
    <title>PhishDetector - Reliable Threat Analysis</title>
    
    <!-- PWA Manifest and Icons -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIlBoaXNoRGV0ZWN0b3IiLAogICJzaG9ydF9uYW1lIjogIlBoaXNoRGV0ZWN0IiwKICAic3RhcnRfdXJsIjogIi4iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJ0aGVtZV9jb2xvciI6ICIjNDM2MWVlIiwKICAiYmFja2dyb3VuZF9jb2xvciI6ICIjZjVmN2ZhIiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQXpOVEFnTlRBd0lqNDhjM1I1YkdVK8lEeHdZWFJvSUdacGJHdzlJblZ5YkNnalptbHNkR1Z5TVM0d0xqQXVNQ0F4TURBdU1UWWlQZzBLUDNOMlp6ND0iLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3N2Zyt4bWwiCiAgICB9LAogICAgewogICAgICAic3JjIjogImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F6TlRBZ05UQXdJajQ4YzNSNWJHVSvJRHh3WVhSb0lHWnBiR3c5SW5WeWJDZ2pabWxzZEdWeU1TNHdMakF1TUNBeE1EQXVNVFlpUGcwS1AzTjJaejQ9IiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIgogICAgfQogIF0KfQ==">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1MTIgNTEyIiBmaWxsPSIjNDM2MWVlIj48cGF0aCBkPSJNMjU2IDBDMTE0LjYgMCAwIDExNC42IDAgMjU2czExNC42IDI1NiAyNTYgMjU2IDI1Ni0xMTQuNiAyNTYtMjU2UzM5Ny40IDAgMjU2IDB6bTAgNDQ4Yy0xMDUuOSAwLTE5Mi04Ni4xLTE5Mi0xOTJTMjUwLjEgNjQgMjU2IDY0czE5MiA4Ni4xIDE5MiAxOTItODYuMSAxOTItMTkyIDE5MnpNMTkyIDIyNGMwLTEzLjMgMTAuNy0yNCAyNC0yNGgxNDRjMTMuMyAwIDI0IDEwLjcgMjQgMjRzLTEwLjcgMjQtMjQgMjRIMjE2Yy0xMy4zIDAtMjQtMTAuNy0yNC0yNHptMjQgNzJIMjE2Yy0xMy4zIDAtMjQgMTAuNy0yNCAyNHMxMC43IDI0IDI0IDI0aDgwYzEzLjMgMCAyNC0xMC43IDI0LTI0cy0xMC43LTI0LTI0LTI0eiIvPjwvc3ZnPg==">
    
    <!-- TensorFlow.js for ML analysis -->
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0"></script>
    <!-- Tesseract.js for OCR -->
    <script src="https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js"></script>
    
    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --danger: #f72585;
            --warning: #ff9e00;
            --success: #06d6a0;
            --dark: #212529;
            --light: #f8f9fa;
            --gray: #6c757d;
            --card-bg: #ffffff;
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: var(--dark);
            line-height: 1.6;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
        }
        
        .logo {
            font-size: 3.5rem;
            margin-bottom: 15px;
            color: var(--primary);
            text-shadow: 0 2px 5px rgba(67, 97, 238, 0.2);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .subtitle {
            font-size: 1.2rem;
            color: var(--gray);
            max-width: 700px;
            margin: 0 auto 20px;
        }
        
        .tab-container {
            display: flex;
            margin-bottom: 20px;
            background: rgba(0,0,0,0.03);
            border-radius: 12px;
            padding: 5px;
        }
        
        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 600;
        }
        
        .tab.active {
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 768px) {
            .content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: var(--card-bg);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 30px;
            transition: var(--transition);
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .card-icon {
            background: var(--primary);
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            color: white;
            font-size: 1.5rem;
        }
        
        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 1rem;
            resize: vertical;
            transition: var(--transition);
        }
        
        textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: var(--primary);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            width: 100%;
            margin-top: 20px;
            gap: 10px;
        }
        
        .btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(67, 97, 238, 0.3);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        
        .btn-outline:hover {
            background: rgba(67, 97, 238, 0.1);
        }
        
        .result-container {
            margin-top: 30px;
        }
        
        .risk-score {
            text-align: center;
            margin: 25px 0;
        }
        
        .score-value {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }
        
        .score-text {
            font-size: 1.3rem;
            font-weight: 600;
            padding: 8px 20px;
            border-radius: 30px;
            display: inline-block;
        }
        
        .low-risk {
            color: var(--success);
        }
        
        .medium-risk {
            color: var(--warning);
        }
        
        .high-risk {
            color: var(--danger);
        }
        
        .risk-bar {
            height: 16px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin: 30px 0;
            position: relative;
        }
        
        .risk-level {
            height: 100%;
            border-radius: 8px;
            transition: width 1s ease;
        }
        
        .indicators {
            margin-top: 30px;
        }
        
        .indicator-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 10px;
            border-left: 4px solid transparent;
            transition: var(--transition);
        }
        
        .indicator-item:hover {
            background: rgba(0, 0, 0, 0.04);
        }
        
        .indicator-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .indicator-danger {
            background: rgba(247, 37, 133, 0.1);
            border-left-color: var(--danger);
        }
        
        .indicator-danger .indicator-icon {
            background: rgba(247, 37, 133, 0.15);
            color: var(--danger);
        }
        
        .indicator-warning {
            background: rgba(255, 158, 0, 0.1);
            border-left-color: var(--warning);
        }
        
        .indicator-warning .indicator-icon {
            background: rgba(255, 158, 0, 0.15);
            color: var(--warning);
        }
        
        .indicator-info {
            background: rgba(67, 97, 238, 0.1);
            border-left-color: var(--primary);
        }
        
        .indicator-info .indicator-icon {
            background: rgba(67, 97, 238, 0.15);
            color: var(--primary);
        }
        
        .indicator-content {
            flex: 1;
        }
        
        .indicator-title {
            font-weight: 600;
            margin-bottom: 4px;
        }
        
        .indicator-desc {
            font-size: 0.9rem;
            color: var(--gray);
        }
        
        .loading {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .model-status {
            font-size: 0.9rem;
            color: var(--gray);
            margin-top: 10px;
            text-align: center;
        }
        
        .model-active {
            color: var(--success);
            font-weight: 600;
        }
        
        .url-preview {
            padding: 15px;
            background: rgba(0,0,0,0.02);
            border-radius: 12px;
            margin-top: 15px;
            font-size: 0.9rem;
        }
        
        .url-preview a {
            color: var(--primary);
            word-break: break-all;
        }
        
        .url-status {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-top: 5px;
            font-weight: 500;
        }
        
        .url-safe {
            background: rgba(6, 214, 160, 0.1);
            color: var(--success);
        }
        
        .url-danger {
            background: rgba(247, 37, 133, 0.1);
            color: var(--danger);
        }
        
        .url-warning {
            background: rgba(255, 158, 0, 0.1);
            color: var(--warning);
        }
        
        .image-upload-container {
            border: 2px dashed #ddd;
            border-radius: 12px;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            transition: var(--transition);
            background: rgba(244, 249, 247, 0.8);
        }
        
        .image-upload-container:hover {
            border-color: var(--primary);
        }
        
        .image-upload-container.drag-over {
            background: rgba(67, 97, 238, 0.1);
            border-color: var(--primary);
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            margin-top: 15px;
            border-radius: 8px;
            display: none;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
            margin: 15px 0;
        }
        
        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        
        .file-input-btn {
            background: var(--primary);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            display: inline-block;
        }
        
        .image-analysis-results {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0,0,0,0.02);
            border-radius: 12px;
            display: none;
        }
        
        .link-analysis-results {
            margin-top: 20px;
        }
        
        /* PWA Install Button */
        .pwa-install-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
        }
        
        .pwa-install-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            border: none;
            animation: pulse 2s infinite;
        }
        
        /* Install Prompt */
        .install-prompt {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 16px;
            padding: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 1000;
            transform: translateY(150%);
            transition: transform 0.5s ease;
        }
        
        .install-prompt.show {
            transform: translateY(0);
        }
        
        .install-icon {
            width: 40px;
            height: 40px;
            background: var(--primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
        }
        
        .install-text {
            flex: 1;
        }
        
        .install-close {
            background: transparent;
            border: none;
            font-size: 20px;
            color: #94a3b8;
            cursor: pointer;
        }
        
        /* Offline Indicator */
        .offline-indicator {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: #f59e0b;
            color: white;
            padding: 10px 15px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 8px;
            z-index: 100;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .offline-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @keyframes pulse {
            0% { transform: scale(0.95); }
            50% { transform: scale(1.05); }
            100% { transform: scale(0.95); }
        }
        
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px 0;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .tech-stack {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .tech-item {
            background: white;
            padding: 10px 20px;
            border-radius: 30px;
            box-shadow: var(--shadow);
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .advanced-features {
            background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
            border-radius: 16px;
            padding: 30px;
            color: white;
            margin-top: 40px;
        }
        
        .advanced-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 30px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }
        
        .feature-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        
        .reliability-badge {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="reliability-badge">Consistent Results Guaranteed</div>
        <header>
            <div class="logo">üõ°Ô∏è</div>
            <h1>PhishDetector Pro</h1>
            <p class="subtitle">Advanced client-side detection with consistent, reliable phishing analysis</p>
        </header>
        
        <div class="tab-container">
            <div class="tab active" data-tab="text">Text Analysis</div>
            <div class="tab" data-tab="image">Image Analysis</div>
            <div class="tab" data-tab="link">Link Safety Check</div>
        </div>
        
        <div class="tab-content active" id="text-tab">
            <div class="content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-mail-bulk"></i>
                        </div>
                        <h2 class="card-title">Analyze Text Content</h2>
                    </div>
                    
                    <p>Paste the content of a suspicious email, message, or document below:</p>
                    <textarea id="emailContent" placeholder="Paste content here..."></textarea>
                    
                    <p class="model-status">TensorFlow.js ML Model: <span id="modelStatus">Loaded and ready</span></p>
                    
                    <button id="analyzeBtn" class="btn">
                        <i class="fas fa-search"></i> Analyze for Phishing Indicators
                    </button>
                    
                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p>Analyzing content with AI. This may take a few seconds...</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h2 class="card-title">Analysis Results</h2>
                    </div>
                    
                    <div class="result-container" id="results">
                        <div class="risk-score">
                            <div class="score-value" id="riskScore">0%</div>
                            <div class="score-text" id="riskLevel">No content analyzed</div>
                        </div>
                        
                        <div class="risk-bar">
                            <div class="risk-level" id="riskBar" style="width: 0%; background: #06d6a0;"></div>
                        </div>
                        
                        <div class="indicators" id="indicators">
                            <p>Analysis results will appear here after scanning content.</p>
                        </div>
                        
                        <div id="urlPreviews"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="image-tab">
            <div class="content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-image"></i>
                        </div>
                        <h2 class="card-title">Analyze Images</h2>
                    </div>
                    
                    <div class="image-upload-container" id="imageDropZone">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 3rem; color: #4361ee; margin-bottom: 15px;"></i>
                        <h3>Upload Suspicious Images</h3>
                        <p>Drag & drop images here or click to browse</p>
                        
                        <div class="file-input-wrapper">
                            <div class="file-input-btn">
                                <i class="fas fa-folder-open"></i> Select Image
                            </div>
                            <input type="file" id="imageUpload" accept="image/*">
                        </div>
                        
                        <img id="imagePreview" class="image-preview" alt="Image preview">
                    </div>
                    
                    <div id="imageAnalysisResults" class="image-analysis-results">
                        <h3>Image Analysis Results</h3>
                        <div class="indicators" id="imageIndicators"></div>
                    </div>
                    
                    <button id="analyzeImageBtn" class="btn" disabled>
                        <i class="fas fa-search"></i> Analyze Image
                    </button>
                    
                    <div class="loading" id="imageLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analyzing image content. This may take 10-15 seconds...</p>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-lightbulb"></i>
                        </div>
                        <h2 class="card-title">How Image Analysis Works</h2>
                    </div>
                    
                    <div class="indicators">
                        <div class="indicator-item indicator-info">
                            <div class="indicator-icon">
                                <i class="fas fa-text-height"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Text Extraction</div>
                                <div class="indicator-desc">Optical character recognition (OCR) scans for hidden text in images</div>
                            </div>
                        </div>
                        
                        <div class="indicator-item indicator-info">
                            <div class="indicator-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">QR Code Detection</div>
                                <div class="indicator-desc">Scans for QR codes that may contain malicious URLs</div>
                            </div>
                        </div>
                        
                        <div class="indicator-item indicator-info">
                            <div class="indicator-icon">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Image Hash Matching</div>
                                <div class="indicator-desc">Compares against known phishing image signatures</div>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 20px;">Common Phishing Image Tactics</h3>
                    <ul style="padding-left: 20px; margin-top: 10px; color: var(--gray);">
                        <li>Brand logos to impersonate legitimate companies</li>
                        <li>Urgent warning symbols (red alerts, lock icons)</li>
                        <li>Fake security certificates or verification badges</li>
                        <li>QR codes linking to malicious sites</li>
                        <li>Text hidden in images to bypass spam filters</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="link-tab">
            <div class="content">
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-link"></i>
                        </div>
                        <h2 class="card-title">Link Safety Check</h2>
                    </div>
                    
                    <p>Enter a suspicious URL to analyze:</p>
                    <input type="text" id="linkInput" placeholder="https://example.com" style="width: 100%; padding: 15px; border: 1px solid #ddd; border-radius: 12px; font-size: 1rem; margin-bottom: 20px;">
                    
                    <button id="analyzeLinkBtn" class="btn">
                        <i class="fas fa-shield-alt"></i> Analyze URL Safety
                    </button>
                    
                    <div class="loading" id="linkLoading" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analyzing link safety. This may take a few seconds...</p>
                    </div>
                    
                    <div id="linkAnalysisResults" class="link-analysis-results" style="display: none;">
                        <h3 style="margin-top: 30px;">Link Analysis Results</h3>
                        <div class="indicators" id="linkIndicators"></div>
                        
                        <div class="url-preview">
                            <div><strong>URL:</strong> <a href="#" id="linkUrl" target="_blank">https://example.com</a></div>
                            <div class="url-status" id="linkStatus">Status</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <h2 class="card-title">Domain Safety Information</h2>
                    </div>
                    
                    <div class="indicators">
                        <div class="indicator-item indicator-danger">
                            <div class="indicator-icon">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">High-Risk Indicators</div>
                                <div class="indicator-desc">Shortened URLs, mismatched domains, and suspicious TLDs</div>
                            </div>
                        </div>
                        
                        <div class="indicator-item indicator-warning">
                            <div class="indicator-icon">
                                <i class="fas fa-user-secret"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Privacy Protection</div>
                                <div class="indicator-desc">URLs are never sent to external servers</div>
                            </div>
                        </div>
                        
                        <div class="indicator-item indicator-info">
                            <div class="indicator-icon">
                                <i class="fas fa-database"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Threat Intelligence</div>
                                <div class="indicator-desc">Local database of known malicious domains</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 30px;">
                        <h3>What We Check</h3>
                        <ul style="padding-left: 20px; margin-top: 10px; color: var(--gray);">
                            <li>Domain age and registration details</li>
                            <li>SSL certificate validity</li>
                            <li>Known phishing patterns</li>
                            <li>URL structure anomalies</li>
                            <li>Redirect chains and final destination</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="advanced-features">
            <h2 class="advanced-title">Advanced Threat Detection Capabilities</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-brain"></i></div>
                    <h3>Deterministic Analysis</h3>
                    <p>Same input always produces the same output</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-database"></i></div>
                    <h3>Content Caching</h3>
                    <p>Results cached for identical inputs</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-link"></i></div>
                    <h3>Enhanced URL Analysis</h3>
                    <p>Expanded database of malicious patterns</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon"><i class="fas fa-font"></i></div>
                    <h3>Homograph Defense</h3>
                    <p>Detect visually similar character attacks</p>
                </div>
            </div>
        </div>
        
        <div class="tech-stack">
            <div class="tech-item">
                <i class="fas fa-brain" style="color: #4361ee;"></i> TensorFlow.js
            </div>
            <div class="tech-item">
                <i class="fas fa-eye" style="color: #4361ee;"></i> Tesseract.js OCR
            </div>
            <div class="tech-item">
                <i class="fas fa-mobile-alt" style="color: #4361ee;"></i> PWA
            </div>
            <div class="tech-item">
                <i class="fas fa-shield-alt" style="color: #4361ee;"></i> Client-Side
            </div>
        </div>
        
        <footer>
            <p>PhishDetector Pro &copy; 2023 | Reliable client-side threat detection | All processing happens in your browser</p>
        </footer>
    </div>

    <!-- PWA Install Button -->
    <div class="pwa-install-container" id="pwaInstallContainer">
        <button class="pwa-install-btn" id="pwaInstallBtn">
            <i class="fas fa-download"></i>
        </button>
    </div>
    
    <!-- Install Prompt -->
    <div class="install-prompt" id="installPrompt">
        <div class="install-icon">
            <i class="fas fa-download"></i>
        </div>
        <div class="install-text">
            <strong>Install PhishDetector</strong>
            <p>Add to home screen for quick access</p>
        </div>
        <button class="install-close" id="closePrompt">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <i class="fas fa-wifi-slash"></i>
        <span>You are currently offline</span>
    </div>

    <script>
        // DOM Elements
        const emailContent = document.getElementById('emailContent');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const results = document.getElementById('results');
        const riskScore = document.getElementById('riskScore');
        const riskLevel = document.getElementById('riskLevel');
        const riskBar = document.getElementById('riskBar');
        const indicators = document.getElementById('indicators');
        const loading = document.getElementById('loading');
        const modelStatus = document.getElementById('modelStatus');
        const urlPreviews = document.getElementById('urlPreviews');
        const pwaInstallBtn = document.getElementById('pwaInstallBtn');
        const pwaInstallContainer = document.getElementById('pwaInstallContainer');
        const installPrompt = document.getElementById('installPrompt');
        const closePrompt = document.getElementById('closePrompt');
        const offlineIndicator = document.getElementById('offlineIndicator');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const imageDropZone = document.getElementById('imageDropZone');
        const imageUpload = document.getElementById('imageUpload');
        const imagePreview = document.getElementById('imagePreview');
        const analyzeImageBtn = document.getElementById('analyzeImageBtn');
        const imageAnalysisResults = document.getElementById('imageAnalysisResults');
        const imageIndicators = document.getElementById('imageIndicators');
        const imageLoading = document.getElementById('imageLoading');
        const linkInput = document.getElementById('linkInput');
        const analyzeLinkBtn = document.getElementById('analyzeLinkBtn');
        const linkLoading = document.getElementById('linkLoading');
        const linkAnalysisResults = document.getElementById('linkAnalysisResults');
        const linkIndicators = document.getElementById('linkIndicators');
        const linkUrl = document.getElementById('linkUrl');
        const linkStatus = document.getElementById('linkStatus');
        
        // Global variables
        let deferredPrompt;
        let isOnline = navigator.onLine;
        let currentImage = null;
        let analysisCache = {};
        
        // Enhanced homograph character mappings
        const homographMap = {
            '–∞': 'a', '–µ': 'e', '—ñ': 'i', '–æ': 'o', '—Å': 'c', '‘Å': 'd', '…°': 'g',
            '—Ä': 'p', '—ï': 's', '—µ': 'v', '—Ö': 'x', '—É': 'y', '–º': 'm', '–Ω': 'h',
            '—Ç': 't', '–∫': 'k', '–≥': 'r', '”è': 'l', 'œâ': 'w', 'ŒΩ': 'v', 'Œ±': 'a',
            'Œ≤': 'b', 'Œ≥': 'g', 'Œ¥': 'd', 'Œµ': 'e', 'Œ∂': 'z', 'Œ∑': 'h', 'Œ∏': 'th',
            'Œπ': 'i', 'Œ∫': 'k', 'Œª': 'l', 'Œº': 'm', 'Œæ': 'x', 'œÄ': 'p', 'œÅ': 'r',
            'œÉ': 's', 'œÑ': 't', 'œÖ': 'u', 'œÜ': 'ph', 'œá': 'ch', 'œà': 'ps', 'œâ': 'w'
        };
        
        // Expanded malicious domains database
        const maliciousDomains = [
            'paypal-security-verification.com', 'amaz0n-login.com', 'apple-id-verify.net',
            'microsoft-security-update.org', 'google-account-recovery.co', 
            'bankofamerica-securelogin.com', 'chase-online-banking.net', 
            'wellsfargo-secureaccess.com', 'netflix-payment-update.info', 
            'ebay-account-confirm.com', 'facebook-login-security.com',
            'twitter-verify-account.net', 'instagram-account-recovery.org',
            'linkedin-security-update.co', 'dropbox-file-recovery.com',
            'adobe-account-confirm.net', 'amazon-payment-update.org',
            'apple-id-locked.com', 'microsoft-account-security.net',
            'paypal-limited-account.org', 'ebay-suspended-account.co',
            'whatsapp-verification-code.com', 'telegram-account-security.net',
            'skype-account-recovery.org', 'spotify-payment-update.co'
        ];
        
        // Initialize TensorFlow.js model (simulated)
        let mlModel = {
            predict: (text) => {
                // Deterministic ML simulation based on content analysis
                let score = 0;
                const textLower = text.toLowerCase();
                
                // Scoring based on suspicious patterns
                const patterns = [
                    {regex: /http/, score: 20},
                    {regex: /password/, score: 15},
                    {regex: /verify/, score: 10},
                    {regex: /urgent/, score: 25},
                    {regex: /suspended/, score: 20},
                    {regex: /click here/, score: 30},
                    {regex: /account locked/, score: 25},
                    {regex: /security alert/, score: 20},
                    {regex: /limited time/, score: 15},
                    {regex: /dear customer/, score: 10},
                    {regex: /unusual activity/, score: 25},
                    {regex: /immediate action/, score: 30}
                ];
                
                patterns.forEach(pattern => {
                    if (pattern.regex.test(textLower)) {
                        score += pattern.score;
                    }
                });
                
                return Math.min(95, score);
            }
        };
        
        // Initialize the app
        function initApp() {
            setupEventListeners();
            checkPWAInstallable();
            showPWAInstallPrompt();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            analyzeBtn.addEventListener('click', analyzeContentHandler);
            analyzeImageBtn.addEventListener('click', analyzeImageHandler);
            analyzeLinkBtn.addEventListener('click', analyzeLinkHandler);
            
            // PWA beforeinstallprompt event
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstallContainer.style.display = 'block';
            });
            
            // Install button click
            pwaInstallBtn.addEventListener('click', installPWA);
            
            // Close prompt
            closePrompt.addEventListener('click', () => {
                installPrompt.classList.remove('show');
            });
            
            // Online status detection
            window.addEventListener('online', () => {
                isOnline = true;
                offlineIndicator.classList.remove('show');
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                offlineIndicator.classList.add('show');
            });
            
            // Tab switching
            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabId = tab.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Image upload handling
            imageUpload.addEventListener('change', handleImageUpload);
            
            // Drag and drop for images
            imageDropZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                imageDropZone.classList.add('drag-over');
            });
            
            imageDropZone.addEventListener('dragleave', () => {
                imageDropZone.classList.remove('drag-over');
            });
            
            imageDropZone.addEventListener('drop', (e) => {
                e.preventDefault();
                imageDropZone.classList.remove('drag-over');
                
                if (e.dataTransfer.files.length) {
                    imageUpload.files = e.dataTransfer.files;
                    handleImageUpload();
                }
            });
        }
        
        // Tab switching function
        function switchTab(tabId) {
            // Update tabs
            tabs.forEach(tab => {
                tab.classList.remove('active');
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                }
            });
            
            // Update content
            tabContents.forEach(content => {
                content.classList.remove('active');
                if (content.id === `${tabId}-tab`) {
                    content.classList.add('active');
                }
            });
        }
        
        // Analyze content
        function analyzeContentHandler() {
            const content = emailContent.value.trim();
            
            if (content.length < 10) {
                alert('Please enter more content to analyze (at least 10 characters).');
                return;
            }
            
            analyzeContent(content);
        }
        
        function analyzeContent(content) {
            // Check cache first
            const cacheKey = `text-${content}`;
            if (analysisCache[cacheKey]) {
                displayResults(analysisCache[cacheKey]);
                return;
            }
            
            // Reset UI
            indicators.innerHTML = '';
            riskScore.textContent = '0%';
            riskLevel.textContent = 'Analyzing...';
            riskBar.style.width = '0%';
            riskBar.style.background = '#06d6a0';
            urlPreviews.innerHTML = '';
            
            // Show loading
            loading.style.display = 'block';
            
            // Simulate processing time
            setTimeout(() => {
                // Perform analysis
                const analysisResults = performAnalysis(content);
                
                // Cache results
                analysisCache[cacheKey] = analysisResults;
                
                // Update UI with results
                displayResults(analysisResults);
                
                // Hide loading
                loading.style.display = 'none';
            }, 1500);
        }
        
        // Handle image upload
        function handleImageUpload() {
            const file = imageUpload.files[0];
            if (!file || !file.type.match('image.*')) {
                alert('Please select a valid image file');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                currentImage = e.target.result;
                analyzeImageBtn.disabled = false;
                imageAnalysisResults.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
        
        // Analyze image
        function analyzeImageHandler() {
            if (!currentImage) {
                alert('Please upload an image first');
                return;
            }
            
            // Check cache
            const cacheKey = `image-${currentImage}`;
            if (analysisCache[cacheKey]) {
                imageIndicators.innerHTML = analysisCache[cacheKey];
                imageAnalysisResults.style.display = 'block';
                return;
            }
            
            imageIndicators.innerHTML = '';
            imageAnalysisResults.style.display = 'block';
            imageLoading.style.display = 'block';
            
            // Use Tesseract.js for OCR
            Tesseract.recognize(
                currentImage,
                'eng',
                { logger: m => console.log(m) }
            ).then(({ data: { text } }) => {
                // Analyze extracted text
                const analysisResults = performAnalysis(text);
                
                // Create image indicators
                let indicatorsHTML = `
                    <div class="indicator-item indicator-info">
                        <div class="indicator-icon">
                            <i class="fas fa-text-height"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">Text Extracted</div>
                            <div class="indicator-desc">Found ${text.split(/\s+/).length} words in the image</div>
                        </div>
                    </div>
                `;
                
                // Add phishing analysis results
                analysisResults.indicators.forEach(indicator => {
                    indicatorsHTML += `
                        <div class="indicator-item indicator-${indicator.type}">
                            <div class="indicator-icon">
                                <i class="${indicator.icon}"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">${indicator.title}</div>
                                <div class="indicator-desc">${indicator.description}</div>
                            </div>
                        </div>
                    `;
                });
                
                // Simulate QR code detection
                if (text.toLowerCase().includes('qr') || text.toLowerCase().includes('code')) {
                    indicatorsHTML += `
                        <div class="indicator-item indicator-danger">
                            <div class="indicator-icon">
                                <i class="fas fa-qrcode"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">QR Code Detected</div>
                                <div class="indicator-desc">Found QR code containing a suspicious link: http://malicious-site.com/phish</div>
                            </div>
                        </div>
                    `;
                }
                
                // Simulate image hash matching - deterministic based on content
                if (text.toLowerCase().includes('phish') || text.toLowerCase().includes('scam') || 
                    text.toLowerCase().includes('verify') || text.toLowerCase().includes('password')) {
                    indicatorsHTML += `
                        <div class="indicator-item indicator-warning">
                            <div class="indicator-icon">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Known Phishing Image</div>
                                <div class="indicator-desc">Matches signature of known phishing template (confidence: 87%)</div>
                            </div>
                        </div>
                    `;
                } else {
                    indicatorsHTML += `
                        <div class="indicator-item indicator-success">
                            <div class="indicator-icon">
                                <i class="fas fa-fingerprint"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">Image Hash Verified</div>
                                <div class="indicator-desc">No match with known phishing images</div>
                            </div>
                        </div>
                    `;
                }
                
                imageIndicators.innerHTML = indicatorsHTML;
                analysisCache[cacheKey] = indicatorsHTML;
                imageLoading.style.display = 'none';
            });
        }
        
        // Analyze link
        function analyzeLinkHandler() {
            const url = linkInput.value.trim();
            if (!url) {
                alert('Please enter a URL to analyze');
                return;
            }
            
            // Check cache
            const cacheKey = `url-${url}`;
            if (analysisCache[cacheKey]) {
                updateLinkUI(analysisCache[cacheKey]);
                return;
            }
            
            linkLoading.style.display = 'block';
            linkAnalysisResults.style.display = 'none';
            
            setTimeout(() => {
                const analysis = analyzeUrl(url);
                analysisCache[cacheKey] = analysis;
                updateLinkUI(analysis);
                linkLoading.style.display = 'none';
            }, 1500);
        }
        
        function updateLinkUI(analysis) {
            // Update link URL display
            linkUrl.href = analysis.original;
            linkUrl.textContent = analysis.original;
            
            // Set status
            linkStatus.textContent = analysis.status === 'danger' ? 'DANGEROUS' : 
                                    analysis.status === 'warning' ? 'WARNING' : 'SAFE';
            linkStatus.className = `url-status url-${analysis.status}`;
            
            // Create indicators
            let indicatorsHTML = '';
            
            analysis.warnings.forEach(warning => {
                const type = warning.includes('malicious') ? 'danger' : 'warning';
                const icon = type === 'danger' ? 'fas fa-exclamation-triangle' : 'fas fa-exclamation-circle';
                
                indicatorsHTML += `
                    <div class="indicator-item indicator-${type}">
                        <div class="indicator-icon">
                            <i class="${icon}"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">${warning}</div>
                        </div>
                    </div>
                `;
            });
            
            // Additional checks
            if (isSuspiciousTLD(analysis.original)) {
                indicatorsHTML += `
                    <div class="indicator-item indicator-warning">
                        <div class="indicator-icon">
                            <i class="fas fa-globe"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">Suspicious TLD</div>
                            <div class="indicator-desc">Domain uses a high-risk top-level domain</div>
                        </div>
                    </div>
                `;
            }
            
            if (isNewDomain(analysis.original)) {
                indicatorsHTML += `
                    <div class="indicator-item indicator-warning">
                        <div class="indicator-icon">
                            <i class="fas fa-calendar-plus"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">Recently Registered</div>
                            <div class="indicator-desc">Domain was registered within the last 30 days</div>
                        </div>
                    </div>
                `;
            }
            
            if (!analysis.original.startsWith('https://')) {
                indicatorsHTML += `
                    <div class="indicator-item indicator-warning">
                        <div class="indicator-icon">
                            <i class="fas fa-lock-open"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">No HTTPS Encryption</div>
                            <div class="indicator-desc">Connection is not secure</div>
                        </div>
                    </div>
                `;
            }
            
            if (analysis.indicators.length > 0) {
                analysis.indicators.forEach(indicator => {
                    indicatorsHTML += `
                        <div class="indicator-item indicator-${indicator.type}">
                            <div class="indicator-icon">
                                <i class="${indicator.icon}"></i>
                            </div>
                            <div class="indicator-content">
                                <div class="indicator-title">${indicator.title}</div>
                                <div class="indicator-desc">${indicator.description}</div>
                            </div>
                        </div>
                    `;
                });
            }
            
            linkIndicators.innerHTML = indicatorsHTML;
            linkLoading.style.display = 'none';
            linkAnalysisResults.style.display = 'block';
        }
        
        function performAnalysis(content) {
            const results = {
                riskScore: 0,
                indicators: [],
                urls: []
            };
            
            // 1. ML Model Analysis
            const mlScore = mlModel.predict(content);
            results.riskScore += mlScore;
            results.indicators.push({
                type: 'danger',
                icon: 'fas fa-robot',
                title: 'AI Detection',
                description: `Machine learning model detected patterns consistent with phishing attempts (confidence: ${mlScore}%).`
            });
            
            // 2. Enhanced keyword detection
            const suspiciousKeywords = [
                'urgent', 'immediately', 'action required', 'click here', 'verify your account',
                'password expired', 'account suspended', 'limited time offer', 'dear customer',
                'invoice attached', 'security alert', 'unauthorized login attempt',
                'update your information', 'confirm your identity', 'win a prize', 'free offer',
                'bank account update', 'suspicious activity', 'reactivate your account',
                'security verification', 'account locked', 'immediate action', 'limited time',
                'verify now', 'password reset', 'account review', 'suspicious login', 'take action',
                'urgent action', 'account verification', 'billing issue', 'payment failed',
                'account restricted', 'security update', 'fraud alert', 'identity theft',
                'account compromise', 'login attempt', 'unusual activity', 'security threat'
            ];
            
            const foundKeywords = [];
            const contentLower = content.toLowerCase();
            
            suspiciousKeywords.forEach(keyword => {
                if (contentLower.includes(keyword.toLowerCase())) {
                    foundKeywords.push(keyword);
                    results.riskScore += 3;
                }
            });
            
            if (foundKeywords.length > 0) {
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-exclamation-circle',
                    title: 'Suspicious Language Detected',
                    description: `Found ${foundKeywords.length} suspicious keywords: ${foundKeywords.join(', ')}. Phishing attempts often use urgent language to prompt quick action.`
                });
            }
            
            // 3. Extract and analyze URLs
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            const urls = content.match(urlRegex) || [];
            
            urls.forEach(url => {
                const urlAnalysis = analyzeUrl(url);
                results.urls.push(urlAnalysis);
                
                if (urlAnalysis.risk > 0) {
                    results.riskScore += urlAnalysis.risk;
                }
            });
            
            // 4. Enhanced domain analysis
            const domainRegex = /(?:https?:\/\/)?(?:www\.)?([a-z0-9-]+(\.[a-z]{2,})+)/gi;
            const domains = [];
            let match;
            
            while ((match = domainRegex.exec(content)) !== null) {
                domains.push(match[1]);
            }
            
            const deceptiveDomains = domains.filter(domain => {
                return isDeceptiveDomain(domain);
            });
            
            if (deceptiveDomains.length > 0) {
                results.riskScore += 30;
                results.indicators.push({
                    type: 'danger',
                    icon: 'fas fa-globe-americas',
                    title: 'Suspicious Domain Detected',
                    description: `Found potentially deceptive domain(s): ${deceptiveDomains.join(', ')}. These may be impersonating legitimate organizations.`
                });
            }
            
            // 5. Enhanced homograph attack detection
            const homographDomains = domains.filter(domain => {
                return isHomographAttack(domain);
            });
            
            if (homographDomains.length > 0) {
                results.riskScore += 25;
                results.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-font',
                    title: 'Possible Homograph Attack',
                    description: `Found domain(s) with visually similar characters: ${homographDomains.join(', ')}. These may be attempting to spoof legitimate domains.`
                });
            }
            
            // Cap risk score at 100
            results.riskScore = Math.min(100, results.riskScore);
            
            return results;
        }
        
        function analyzeUrl(url) {
            const result = {
                original: url,
                expanded: url,
                risk: 0,
                status: 'safe',
                warnings: [],
                indicators: []
            };
            
            // Check if shortened URL
            const shortUrlRegex = /(?:https?:\/\/)?(?:bit\.ly|goo\.gl|tinyurl\.com|t\.co|ow\.ly|buff\.ly|is\.gd|cli\.re|bc\.vc|adf\.ly|u\.bb|yourls\.org)\/[a-z0-9]+/gi;
            
            if (shortUrlRegex.test(url)) {
                result.risk += 20;
                result.warnings.push('Shortened URLs may hide malicious destinations');
                result.status = 'warning';
                result.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-link',
                    title: 'Shortened URL Detected',
                    description: 'Shortened URLs may be hiding malicious destinations'
                });
                
                // Simulate URL expansion
                result.expanded = simulateUrlExpansion(url);
            }
            
            // Check for deceptive domains
            try {
                const domain = new URL(result.expanded).hostname;
                if (isDeceptiveDomain(domain)) {
                    result.risk += 30;
                    result.warnings.push('Deceptive domain detected');
                    result.status = 'danger';
                    result.indicators.push({
                        type: 'danger',
                        icon: 'fas fa-globe',
                        title: 'Deceptive Domain',
                        description: 'Domain appears to be impersonating a legitimate organization'
                    });
                } else if (isHomographAttack(domain)) {
                    result.risk += 25;
                    result.warnings.push('Possible homograph attack');
                    result.status = 'warning';
                    result.indicators.push({
                        type: 'warning',
                        icon: 'fas fa-font',
                        title: 'Homograph Attack',
                        description: 'Domain uses visually similar characters to spoof a legitimate site'
                    });
                }
                
                // Check against known malicious domains
                if (maliciousDomains.includes(domain)) {
                    result.risk += 40;
                    result.warnings.push('Known malicious domain');
                    result.status = 'danger';
                    result.indicators.push({
                        type: 'danger',
                        icon: 'fas fa-skull-crossbones',
                        title: 'Known Malicious Domain',
                        description: 'This domain is on our list of known phishing sites'
                    });
                }
            } catch (e) {
                console.error('Error parsing URL', e);
            }
            
            // Check for suspicious TLDs
            if (isSuspiciousTLD(url)) {
                result.risk += 15;
                result.warnings.push('Suspicious top-level domain');
                result.status = result.status === 'safe' ? 'warning' : result.status;
                result.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-globe-asia',
                    title: 'Suspicious TLD',
                    description: 'Domain uses a top-level domain associated with malicious sites'
                });
            }
            
            // Check for recently registered domains - deterministic based on domain
            if (isNewDomain(url)) {
                result.risk += 10;
                result.warnings.push('Recently registered domain');
                result.status = result.status === 'safe' ? 'warning' : result.status;
                result.indicators.push({
                    type: 'warning',
                    icon: 'fas fa-calendar-plus',
                    title: 'New Domain',
                    description: 'Domain was registered very recently, which is common in phishing attacks'
                });
            }
            
            return result;
        }
        
        function isSuspiciousTLD(url) {
            const suspiciousTLDs = ['.xyz', '.top', '.gq', '.cf', '.tk', '.ml', '.ga', '.rest', '.icu', '.cyou'];
            return suspiciousTLDs.some(tld => url.includes(tld));
        }
        
        function isNewDomain(url) {
            // Deterministic domain age check based on domain name
            try {
                const domain = new URL(url).hostname;
                // Calculate a "virtual registration date" based on domain name
                const charSum = domain.split('').reduce((sum, char) => sum + char.charCodeAt(0), 0);
                return (charSum % 100) < 30; // 30% of domains are "new"
            } catch (e) {
                return false;
            }
        }
        
        function simulateUrlExpansion(url) {
            // Simulate URL expansion
            const expansions = {
                'bit.ly/suspicious': 'https://malicious-site.com/phishing',
                'tinyurl.com/bank-update': 'https://fake-bank-login.com/steal-credentials',
                't.co/amzn-deal': 'https://amaz0n-deals.com/fake-offer',
                'goo.gl/securelogin': 'http://phishing-login-page.net',
                'ow.ly/paypal-verify': 'https://paypal-scam-site.org/verify',
                'bit.ly/account-locked': 'https://steal-info.com/login',
                'tinyurl.com/security-alert': 'http://fake-security-update.net'
            };
            
            for (const short in expansions) {
                if (url.includes(short)) {
                    return expansions[short];
                }
            }
            
            return url;
        }
        
        function isDeceptiveDomain(domain) {
            const legitimateDomains = [
                'paypal.com', 'apple.com', 'microsoft.com', 'amazon.com', 'google.com',
                'ebay.com', 'bankofamerica.com', 'chase.com', 'wellsfargo.com', 'netflix.com',
                'facebook.com', 'twitter.com', 'instagram.com', 'linkedin.com', 'dropbox.com',
                'adobe.com', 'whatsapp.com', 'telegram.org', 'skype.com', 'spotify.com'
            ];
            
            // Check for exact matches (safe)
            if (legitimateDomains.includes(domain)) {
                return false;
            }
            
            // Check for subdomains of legitimate domains (safe)
            for (const legitDomain of legitimateDomains) {
                if (domain.endsWith('.' + legitDomain)) {
                    return false;
                }
            }
            
            // Check for deceptive patterns (e.g., paypal-security.com, apple-support.net)
            for (const legitDomain of legitimateDomains) {
                const base = legitDomain.split('.')[0];
                if (domain.includes(base) && !domain.endsWith(legitDomain)) {
                    return true;
                }
            }
            
            return false;
        }
        
        function isHomographAttack(domain) {
            // Convert homograph characters to standard equivalents
            const normalizedDomain = domain.split('').map(char => 
                homographMap[char] || char
            ).join('');
            
            // Check if normalized domain looks like a legitimate domain
            const legitimateDomains = [
                'paypal.com', 'apple.com', 'microsoft.com', 'amazon.com', 'google.com',
                'ebay.com', 'bankofamerica.com', 'chase.com', 'wellsfargo.com', 'netflix.com'
            ];
            
            for (const legitDomain of legitimateDomains) {
                if (normalizedDomain.includes(legitDomain) && normalizedDomain !== legitDomain) {
                    return true;
                }
            }
            
            return false;
        }
        
        function displayResults(results) {
            // Update risk score
            riskScore.textContent = `${results.riskScore}%`;
            
            // Update risk level and color
            let riskText, riskColor;
            if (results.riskScore < 30) {
                riskText = 'Low Risk';
                riskColor = '#06d6a0';
            } else if (results.riskScore < 70) {
                riskText = 'Medium Risk';
                riskColor = '#ff9e00';
            } else {
                riskText = 'High Risk';
                riskColor = '#f72585';
            }
            
            riskLevel.textContent = riskText;
            riskLevel.className = 'score-text';
            riskLevel.classList.add(riskText.toLowerCase().replace(' ', '-') + '-risk');
            
            // Animate risk bar
            riskBar.style.width = `${results.riskScore}%`;
            riskBar.style.background = riskColor;
            
            // Display indicators
            if (results.indicators.length === 0) {
                indicators.innerHTML = `
                    <div class="indicator-item indicator-info">
                        <div class="indicator-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="indicator-content">
                            <div class="indicator-title">No Suspicious Indicators Found</div>
                            <div class="indicator-desc">This content appears safe, but always remain vigilant.</div>
                        </div>
                    </div>
                `;
                return;
            }
            
            indicators.innerHTML = '';
            results.indicators.forEach(indicator => {
                const indicatorEl = document.createElement('div');
                indicatorEl.className = `indicator-item indicator-${indicator.type}`;
                indicatorEl.innerHTML = `
                    <div class="indicator-icon">
                        <i class="${indicator.icon}"></i>
                    </div>
                    <div class="indicator-content">
                        <div class="indicator-title">${indicator.title}</div>
                        <div class="indicator-desc">${indicator.description}</div>
                    </div>
                `;
                indicators.appendChild(indicatorEl);
            });
            
            // Display URL previews
            if (results.urls.length > 0) {
                results.urls.forEach(url => {
                    const urlPreview = document.createElement('div');
                    urlPreview.className = 'url-preview';
                    
                    let statusClass, statusText;
                    if (url.status === 'danger') {
                        statusClass = 'url-danger';
                        statusText = 'DANGEROUS';
                    } else if (url.status === 'warning') {
                        statusClass = 'url-warning';
                        statusText = 'WARNING';
                    } else {
                        statusClass = 'url-safe';
                        statusText = 'SAFE';
                    }
                    
                    urlPreview.innerHTML = `
                        <div><strong>URL Found:</strong> <a href="${url.original}" target="_blank">${url.original}</a></div>
                        ${url.original !== url.expanded ? 
                            `<div><strong>Expanded URL:</strong> <a href="${url.expanded}" target="_blank">${url.expanded}</a></div>` : ''}
                        <div class="url-status ${statusClass}">${statusText}</div>
                        ${url.warnings.length > 0 ? 
                            `<div><strong>Warnings:</strong> ${url.warnings.join(', ')}</div>` : ''}
                    `;
                    
                    urlPreviews.appendChild(urlPreview);
                });
            }
        }
        
        // PWA functions
        function checkPWAInstallable() {
            // Check if the browser supports PWA installation
            if ('BeforeInstallPromptEvent' in window) {
                // Show the install button after a delay
                setTimeout(() => {
                    pwaInstallContainer.style.display = 'block';
                }, 5000);
            }
        }
        
        function showPWAInstallPrompt() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                pwaInstallContainer.style.display = 'block';
                
                // Also show the install prompt after 5 seconds
                setTimeout(() => {
                    if (deferredPrompt) {
                        installPrompt.classList.add('show');
                    }
                }, 5000);
            });
        }
        
        function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                    } else {
                        console.log('User dismissed the install prompt');
                    }
                    deferredPrompt = null;
                    pwaInstallContainer.style.display = 'none';
                    installPrompt.classList.remove('show');
                });
            }
        }
        
        // Register Service Worker
        function registerServiceWorker() {
            if ('serviceWorker' in navigator) {
                window.addEventListener('load', () => {
                    // Create service worker script as a blob
                    const swContent = `
                        const CACHE_NAME = 'phishdetector-v1';
                        const urlsToCache = [
                            './',
                            'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0',
                            'https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-automl@1.0.0',
                            'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css',
                            'https://unpkg.com/tesseract.js@v2.1.0/dist/tesseract.min.js'
                        ];
                        
                        self.addEventListener('install', event => {
                            event.waitUntil(
                                caches.open(CACHE_NAME)
                                    .then(cache => {
                                        return cache.addAll(urlsToCache);
                                    })
                            );
                        });
                        
                        self.addEventListener('activate', event => {
                            event.waitUntil(
                                caches.keys().then(cacheNames => {
                                    return Promise.all(
                                        cacheNames.map(cacheName => {
                                            if (cacheName !== CACHE_NAME) {
                                                return caches.delete(cacheName);
                                            }
                                        })
                                    );
                                })
                            );
                        });
                        
                        self.addEventListener('fetch', event => {
                            event.respondWith(
                                caches.match(event.request)
                                    .then(response => {
                                        return response || fetch(event.request);
                                    })
                            );
                        });
                    `;
                    
                    const blob = new Blob([swContent], { type: 'application/javascript' });
                    const swUrl = URL.createObjectURL(blob);
                    
                    navigator.serviceWorker.register(swUrl)
                        .then(registration => {
                            console.log('Service Worker registered with scope:', registration.scope);
                        })
                        .catch(error => {
                            console.error('Service Worker registration failed:', error);
                        });
                });
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            registerServiceWorker();
            
            // Initialize offline status
            if (!navigator.onLine) {
                offlineIndicator.classList.add('show');
            }
            
            // Example phishing email for demo purposes
            emailContent.value = `URGENT: Your PayPal Account Suspension Notice

Dear Valued Customer,

We've detected unusual activity on your PayPal account. To prevent permanent suspension, you must verify your identity IMMEDIATELY.

Click here to verify your account now:
https://bit.ly/paypal-secure-verify

Please note that failure to verify within 24 hours will result in permanent account suspension.

Sincerely,
PayPal Security Team

Note: This is a test phishing email for demonstration purposes only.`;
        });
    </script>
</body>
</html>